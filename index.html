<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KaKaReza Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background: #000;
      touch-action: none;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Resize canvas to fill screen
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// Screen-based units
let W = () => canvas.width;
let H = () => canvas.height;

// Game objects
let car = {
  w: W() * 0.1,
  h: H() * 0.05,
  x: W() * 0.45,
  y: H() - H() * 0.1 - H() * 0.05, // Adjusted so car is above bottom
};

let bullets = [];
let enemies = [];
let score = 0;
let timer = 60;

// Drawing
function drawCar() {
  ctx.fillStyle = 'white';
  ctx.fillRect(car.x, car.y, car.w, car.h);
}

function drawBullets() {
  ctx.fillStyle = 'red';
  bullets.forEach(b => {
    ctx.fillRect(b.x, b.y, b.w, b.h);
  });
}

function drawEnemies() {
  ctx.fillStyle = 'lime';
  enemies.forEach(e => {
    ctx.fillRect(e.x, e.y, e.w, e.h);
  });
}

function drawHUD() {
  ctx.fillStyle = 'white';
  ctx.font = `${Math.floor(H() * 0.03)}px sans-serif`;
  ctx.fillText(`Score: ${score}`, 10, 30);
  ctx.fillText(`Time: ${timer}`, W() - 100, 30);
}

// Game loop
function update() {
  ctx.clearRect(0, 0, W(), H());

  drawCar();
  drawBullets();
  drawEnemies();
  drawHUD();

  bullets.forEach((b, i) => {
    b.y -= H() * 0.01;
    if (b.y + b.h < 0) bullets.splice(i, 1);
  });

  enemies.forEach((e, i) => {
    e.y += H() * 0.005;
    if (e.y > H()) enemies.splice(i, 1);
  });

  enemies.forEach((e, ei) => {
    bullets.forEach((b, bi) => {
      if (
        b.x < e.x + e.w && b.x + b.w > e.x &&
        b.y < e.y + e.h && b.y + b.h > e.y
      ) {
        enemies.splice(ei, 1);
        bullets.splice(bi, 1);
        score += 10;
      }
    });
  });
}

function spawnEnemy() {
  const size = W() * 0.08;
  enemies.push({
    x: Math.random() * (W() - size),
    y: -size,
    w: size,
    h: size,
  });
}

function shootBullet() {
  const bulletW = W() * 0.02;
  const bulletH = H() * 0.04;
  bullets.push({
    x: car.x + car.w / 2 - bulletW / 2,
    y: car.y,
    w: bulletW,
    h: bulletH
  });
}

// Touch controls
canvas.addEventListener('touchmove', e => {
  const t = e.touches[0];
  if (t.clientY > H() * 0.75) {
    car.x = t.clientX - car.w / 2;
    car.x = Math.max(0, Math.min(car.x, W() - car.w));
  }
}, { passive: false });

canvas.addEventListener('touchstart', e => {
  const t = e.touches[0];
  if (t.clientY < H() * 0.75) {
    shootBullet();
  }
}, { passive: false });

// Keyboard controls
document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') car.x -= W() * 0.05;
  if (e.key === 'ArrowRight') car.x += W() * 0.05;
  if (e.key === ' ') shootBullet();
});

// Game start
setInterval(update, 1000 / 60);
setInterval(spawnEnemy, 1000);
setInterval(() => {
  timer--;
  if (timer <= 0) {
    alert("Time's up! Score: " + score);
    timer = 60;
    score = 0;
    enemies = [];
    bullets = [];
  }
}, 1000);
</script>
</body>
</html>