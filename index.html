<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KaKaReza Shooting Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
      font-family: Arial, sans-serif;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 120px;
      background: #222;
      color: white;
      padding: 10px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.5;
    }
    #gameTitle {
      text-align: center;
      font-size: 14px;
      color: #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="scoreboard">
    <div>Score: <span id="score">0</span></div>
    <div>Missed: <span id="missed">0</span>/10</div>
    <div>Level: <span id="level">1</span>/4</div>
    <div>Time: <span id="timer">30</span>s</div>
    <div id="gameTitle">KaKaReza Shooting Game</div>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    let player = {
      x: width / 2,
      y: height - 80,
      width: 40,
      height: 40,
      speed: 10,
      color: "cyan",
    };

    let bullets = [];
    let obstacles = [];
    let score = 0;
    let missed = 0;
    let level = 1;
    let levelTime = 30;
    let frame = 0;
    let totalObstacles = 0;

    const maxObstacles = 110;
    const allowedMisses = 10;
    const totalLevels = 4;

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.beginPath();
      ctx.moveTo(player.x, player.y);
      ctx.lineTo(player.x - 15, player.y + 40);
      ctx.lineTo(player.x + 15, player.y + 40);
      ctx.closePath();
      ctx.fill();
    }

    function drawBullets() {
      ctx.fillStyle = "yellow";
      bullets.forEach((b) => {
        ctx.fillRect(b.x - 2, b.y, 4, 10);
        b.y -= 10;
      });
      bullets = bullets.filter((b) => b.y > 0);
    }

    function drawObstacles() {
      ctx.fillStyle = "red";
      obstacles.forEach((o) => {
        ctx.fillRect(o.x, o.y, o.size, o.size);
        o.y += o.speed;
      });
      obstacles = obstacles.filter((o) => {
        if (o.y > height) {
          missed++;
          updateScoreboard();
          return false;
        }
        return true;
      });
    }

    function detectCollisions() {
      bullets.forEach((b, bi) => {
        obstacles.forEach((o, oi) => {
          if (
            b.x > o.x &&
            b.x < o.x + o.size &&
            b.y > o.y &&
            b.y < o.y + o.size
          ) {
            bullets.splice(bi, 1);
            obstacles.splice(oi, 1);
            score++;
            updateScoreboard();
          }
        });
      });
    }

    function updateScoreboard() {
      document.getElementById("score").textContent = score;
      document.getElementById("missed").textContent = missed;
      document.getElementById("level").textContent = level;
    }

    function spawnObstacle() {
      if (totalObstacles < maxObstacles) {
        const size = 30;
        const x = Math.random() * (width - size);
        const speed = 2 + level * 0.5;
        obstacles.push({ x, y: 0, size, speed });
        totalObstacles++;
      }
    }

    function gameOver(msg) {
      alert(msg);
      location.reload();
    }

    function nextLevel() {
      if (level >= totalLevels) {
        gameOver("You win! Final Score: " + score);
      } else {
        level++;
        levelTime = 30;
        totalObstacles = 0;
        obstacles = [];
        bullets = [];
        missed = 0;
        updateScoreboard();
      }
    }

    function gameLoop() {
      ctx.clearRect(0, 0, width, height);
      drawPlayer();
      drawBullets();
      drawObstacles();
      detectCollisions();

      if (frame % 15 === 0) spawnObstacle();
      frame++;
      if (missed >= allowedMisses) gameOver("Game Over. Too many missed!");

      requestAnimationFrame(gameLoop);
    }

    setInterval(() => {
      levelTime--;
      document.getElementById("timer").textContent = levelTime;
      if (levelTime <= 0) {
        nextLevel();
      }
    }, 1000);

    // Touch Controls
    let isTouching = false;
    let touchX = 0;

    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      touchX = touch.clientX;
      isTouching = true;
      bullets.push({ x: player.x, y: player.y });
    });

    canvas.addEventListener("touchmove", (e) => {
      if (!isTouching) return;
      const touch = e.touches[0];
      const dx = touch.clientX - touchX;
      player.x += dx;
      player.x = Math.max(20, Math.min(player.x, width - 20));
      touchX = touch.clientX;
    });

    canvas.addEventListener("touchend", () => {
      isTouching = false;
    });

    updateScoreboard();
    gameLoop();
  </script>
</body>
</html>