<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>KaKaReza Shooting Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
      background: black;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial, sans-serif;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    <div id="score">Score: 0</div>
    <div id="missed">Missed: 0</div>
    <div id="level">Level: 1</div>
    <div id="timer">Time: 30</div>
  </div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    const player = {
      x: width / 2,
      y: height - 50,
      width: 40,
      height: 40,
      color: "cyan",
      speed: 15,
      bullets: [],
      canFire: true,
      fireRate: 100,
      powerLevel: 1,
      fireCount: 0
    };

    let score = 0;
    let missed = 0;
    let level = 1;
    let timer = 30;
    let obstacles = [];
    let interval;
    let gameOver = false;
    const maxMisses = 10;
    const levelData = {
      1: { total: 110, speed: 3 },
      2: { total: 110, speed: 4 },
      3: { total: 110, speed: 5 },
      4: { total: 110, speed: 6 }
    };

    function createObstacle() {
      const size = 30;
      const x = Math.random() * (width - size);
      const y = -size;
      const speed = levelData[level]?.speed || 4;
      const color = ["red", "yellow", "orange", "green", "blue"][Math.floor(Math.random()*5)];
      obstacles.push({ x, y, size, speed, color });
    }

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function drawBullets() {
      ctx.fillStyle = "lime";
      player.bullets.forEach((b) => ctx.fillRect(b.x, b.y, 5, 15));
    }

    function drawObstacles() {
      obstacles.forEach((o) => {
        ctx.fillStyle = o.color;
        ctx.fillRect(o.x, o.y, o.size, o.size);
      });
    }

    function updateGame() {
      ctx.clearRect(0, 0, width, height);
      drawPlayer();
      drawBullets();
      drawObstacles();

      player.bullets = player.bullets.filter(b => b.y > 0);
      player.bullets.forEach(b => b.y -= 10);

      obstacles.forEach(o => o.y += o.speed);
      obstacles = obstacles.filter(o => {
        if (o.y > height) {
          missed++;
          updateUI();
          if (missed >= maxMisses) endGame();
          return false;
        }
        return true;
      });

      player.bullets.forEach((b, bi) => {
        obstacles.forEach((o, oi) => {
          if (b.x > o.x && b.x < o.x + o.size && b.y < o.y + o.size && b.y > o.y) {
            player.bullets.splice(bi, 1);
            obstacles.splice(oi, 1);
            score++;
            player.fireCount++;
            if (player.fireCount % 5 === 0 && player.powerLevel < 3) player.powerLevel++;
          }
        });
      });
    }

    function fireBullets() {
      if (!player.canFire) return;
      player.canFire = false;
      const midX = player.x + player.width / 2;
      const baseY = player.y;

      if (player.powerLevel === 1) {
        player.bullets.push({ x: midX, y: baseY });
      } else if (player.powerLevel === 2) {
        player.bullets.push({ x: midX - 10, y: baseY });
        player.bullets.push({ x: midX + 10, y: baseY });
      } else {
        player.bullets.push({ x: midX, y: baseY });
        player.bullets.push({ x: midX - 15, y: baseY });
        player.bullets.push({ x: midX + 15, y: baseY });
      }

      setTimeout(() => player.canFire = true, player.fireRate);
    }

    function updateUI() {
      document.getElementById("score").textContent = "Score: " + score;
      document.getElementById("missed").textContent = "Missed: " + missed;
      document.getElementById("level").textContent = "Level: " + level;
    }

    function startLevel() {
      updateUI();
      interval = setInterval(() => {
        if (levelData[level]?.total > 0) {
          createObstacle();
          levelData[level].total--;
        } else {
          clearInterval(interval);
        }
      }, 500);

      const timerInterval = setInterval(() => {
        if (--timer <= 0) {
          clearInterval(timerInterval);
          level++;
          if (level > 4) endGame();
          else {
            timer = 30;
            startLevel();
          }
        }
        document.getElementById("timer").textContent = "Time: " + timer;
      }, 1000);
    }

    function endGame() {
      gameOver = true;
      alert("Game Over! Final Score: " + score);
      location.reload();
    }

    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      const x = touch.clientX;
      const y = touch.clientY;
      fireBullets();
      if (x > 0 && y > height - 100) {
        player.x = x - player.width / 2;
      }
    });

    canvas.addEventListener("touchmove", (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const x = touch.clientX;
      if (x > 0) {
        player.x = x - player.width / 2;
      }
    }, { passive: false });

    startLevel();
    setInterval(() => {
      if (!gameOver) updateGame();
    }, 30);
  </script>
</body>
</html>