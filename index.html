<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>KaKaReza Shooting Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
      margin-left: 100px;
      background-image: url('starry_background.png');
      background-size: cover;
    }
    #scoreboard {
      position: absolute;
      left: 0;
      top: 0;
      width: 100px;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      font-family: Arial, sans-serif;
      padding: 10px;
      box-sizing: border-box;
    }
    #scoreboard h2 {
      font-size: 16px;
      margin-top: 0;
      text-align: center;
    }
    #scoreboard div {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    <h2>KaKaReza<br>Shooting Game</h2>
    <div id="score">Score: 0</div>
    <div id="missed">Missed: 0</div>
    <div id="level">Level: 1</div>
    <div id="timer">Time: 30</div>
  </div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let width = window.innerWidth - 100;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    // Load assets
    const player = {
      x: width / 2,
      y: height - 80,
      width: 40,
      height: 40,
      color: "cyan",
      speed: 15,
      bullets: [],
      fireRate: 100,
      canFire: true,
      powerLevel: 1,
      fireCount: 0
    };

    let score = 0;
    let missed = 0;
    let level = 1;
    let timer = 30;
    let obstacles = [];
    let interval;
    let gameOver = false;
    let boss = null;
    const maxMisses = 10;
    const levelData = {
      1: { total: 110, speed: 3 },
      2: { total: 110, speed: 4 },
      3: { total: 110, speed: 5 },
      4: { total: 110, speed: 6 },
      5: { total: 1, boss: true }
    };

    function createObstacle() {
      const size = 30;
      const x = Math.random() * (width - size);
      const y = -size;
      const speed = levelData[level]?.speed || 4;
      const color = ["red", "yellow", "orange", "green", "blue"][Math.floor(Math.random()*5)];
      obstacles.push({ x, y, size, speed, color, hit: 0 });
    }

    function createBoss() {
      boss = {
        x: width / 2 - 50,
        y: 50,
        width: 100,
        height: 100,
        hitPoints: 300,
        directionX: 2,
        directionY: 1.5
      };
    }

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function drawBullets() {
      ctx.fillStyle = "lime";
      player.bullets.forEach((b) => ctx.fillRect(b.x, b.y, 5, 15));
    }

    function drawObstacles() {
      obstacles.forEach((o) => {
        ctx.fillStyle = o.color;
        ctx.fillRect(o.x, o.y, o.size, o.size);
      });
    }

    function drawBoss() {
      if (boss) {
        ctx.fillStyle = "purple";
        ctx.fillRect(boss.x, boss.y, boss.width, boss.height);
      }
    }

    function updateGame() {
      ctx.clearRect(0, 0, width, height);
      drawPlayer();
      drawBullets();
      drawObstacles();
      if (boss) drawBoss();

      // Update bullets
      player.bullets = player.bullets.filter(b => b.y > 0);
      player.bullets.forEach(b => b.y -= 10);

      // Move obstacles
      obstacles.forEach(o => o.y += o.speed);
      obstacles = obstacles.filter(o => {
        if (o.y > height) {
          missed++;
          updateUI();
          if (missed >= maxMisses) endGame();
          return false;
        }
        return true;
      });

      // Check collisions
      player.bullets.forEach((b, bi) => {
        obstacles.forEach((o, oi) => {
          if (b.x > o.x && b.x < o.x + o.size && b.y < o.y + o.size && b.y > o.y) {
            player.bullets.splice(bi, 1);
            obstacles.splice(oi, 1);
            score++;
            player.fireCount++;
            if (player.fireCount % 5 === 0 && player.powerLevel < 3) player.powerLevel++;
          }
        });

        if (boss && b.x > boss.x && b.x < boss.x + boss.width && b.y < boss.y + boss.height && b.y > boss.y) {
          player.bullets.splice(bi, 1);
          boss.hitPoints--;
          if (boss.hitPoints <= 0) {
            boss = null;
            level++;
            timer = 30;
            startLevel();
          }
        }
      });

      // Move boss
      if (boss) {
        boss.x += boss.directionX;
        boss.y += boss.directionY;
        if (boss.x <= 0 || boss.x + boss.width >= width) boss.directionX *= -1;
        if (boss.y <= 0 || boss.y + boss.height >= height / 2) boss.directionY *= -1;
      }
    }

    function fireBullets() {
      if (!player.canFire) return;
      player.canFire = false;
      const midX = player.x + player.width / 2;
      const baseY = player.y;

      if (player.powerLevel === 1) {
        player.bullets.push({ x: midX, y: baseY });
      } else if (player.powerLevel === 2) {
        player.bullets.push({ x: midX - 10, y: baseY });
        player.bullets.push({ x: midX + 10, y: baseY });
      } else {
        player.bullets.push({ x: midX, y: baseY });
        player.bullets.push({ x: midX - 15, y: baseY });
        player.bullets.push({ x: midX + 15, y: baseY });
      }

      setTimeout(() => player.canFire = true, player.fireRate);
    }

    function updateUI() {
      document.getElementById("score").textContent = "Score: " + score;
      document.getElementById("missed").textContent = "Missed: " + missed;
      document.getElementById("level").textContent = "Level: " + level;
    }

    function startLevel() {
      updateUI();
      if (level === 5) {
        createBoss();
      } else {
        interval = setInterval(() => {
          if (levelData[level]?.total > 0) {
            createObstacle();
            levelData[level].total--;
          } else {
            clearInterval(interval);
          }
        }, 500);
      }

      const timerInterval = setInterval(() => {
        if (--timer <= 0) {
          clearInterval(timerInterval);
          if (!boss) {
            level++;
            if (level > 5) endGame();
            else {
              timer = 30;
              startLevel();
            }
          }
        }
        document.getElementById("timer").textContent = "Time: " + timer;
      }, 1000);
    }

    function endGame() {
      gameOver = true;
      alert("Game Over! Final Score: " + score);
      location.reload();
    }

    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      const x = touch.clientX - 100; // compensate for scoreboard
      const y = touch.clientY;
      fireBullets();
      if (x > 0 && y > height - 100) {
        player.x = x - player.width / 2;
      }
    });

    canvas.addEventListener("touchmove", (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const x = touch.clientX - 100;
      if (x > 0) {
        player.x = x - player.width / 2;
      }
    }, { passive: false });

    startLevel();
    setInterval(() => {
      if (!gameOver) updateGame();
    }, 30);
  </script>
</body>
</html>