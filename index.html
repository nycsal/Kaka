<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KaKaReza Shooting Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      color: white;
      font-family: 'Arial', sans-serif;
      touch-action: none;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      background: rgba(0,0,0,0.6);
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 18px;
      z-index: 10;
    }
    #title {
      text-align: center;
      margin-top: 50px;
      font-size: 24px;
      color: yellow;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    Score: <span id="score">0</span> | Time: <span id="timer">60</span>
    <div id="title">KaKaReza Shooting Game</div>
  </div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let player = {
      x: canvas.width / 2,
      y: canvas.height - 80,
      width: 40,
      height: 40,
      color: "lime",
      speed: 10,
      power: 1,
      fireRate: 200
    };

    let bullets = [];
    let obstacles = [];
    let score = 0;
    let fireInterval;
    let firePowerHits = 0;
    let gameTime = 60;
    let timerId;

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.beginPath();
      ctx.moveTo(player.x, player.y);
      ctx.lineTo(player.x - player.width / 2, player.y + player.height);
      ctx.lineTo(player.x + player.width / 2, player.y + player.height);
      ctx.closePath();
      ctx.fill();
    }

    function drawBullets() {
      ctx.fillStyle = "red";
      bullets.forEach(b => {
        ctx.fillRect(b.x - 2, b.y, 4, 10);
        if (player.power > 1) {
          ctx.fillRect(b.x - 10, b.y, 4, 10);
        }
        if (player.power > 2) {
          ctx.fillRect(b.x + 10, b.y, 4, 10);
        }
      });
    }

    function drawObstacles() {
      obstacles.forEach(o => {
        ctx.fillStyle = o.color;
        ctx.fillRect(o.x, o.y, o.size, o.size);
      });
    }

    function drawScore() {
      document.getElementById("score").innerText = score;
    }

    function shoot() {
      bullets.push({ x: player.x, y: player.y });
    }

    function spawnObstacle() {
      if (obstacles.length < 100) {
        obstacles.push({
          x: Math.random() * (canvas.width - 30),
          y: -30,
          size: 30,
          color: ["orange", "blue", "purple"][Math.floor(Math.random() * 3)],
        });
      }
    }

    function updateBullets() {
      bullets.forEach(b => b.y -= 10);
      bullets = bullets.filter(b => b.y > 0);
    }

    function updateObstacles() {
      obstacles.forEach(o => o.y += 4);
      obstacles = obstacles.filter(o => o.y < canvas.height);
    }

    function detectCollisions() {
      bullets.forEach((b, i) => {
        obstacles.forEach((o, j) => {
          if (b.x > o.x && b.x < o.x + o.size && b.y > o.y && b.y < o.y + o.size) {
            bullets.splice(i, 1);
            obstacles.splice(j, 1);
            score++;
            firePowerHits++;
            if (firePowerHits % 5 === 0 && player.power < 3) player.power++;
          }
        });
      });
    }

    function updateGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawBullets();
      drawObstacles();
      updateBullets();
      updateObstacles();
      detectCollisions();
      drawScore();
      requestAnimationFrame(updateGame);
    }

    function startFiring() {
      if (!fireInterval) fireInterval = setInterval(shoot, player.fireRate);
    }

    function stopFiring() {
      clearInterval(fireInterval);
      fireInterval = null;
    }

    canvas.addEventListener("touchstart", (e) => {
      const touchX = e.touches[0].clientX;
      const touchY = e.touches[0].clientY;

      if (touchY > canvas.height * 0.7) {
        player.x = touchX;
      } else {
        startFiring();
      }
    });

    canvas.addEventListener("touchmove", (e) => {
      const touchX = e.touches[0].clientX;
      const touchY = e.touches[0].clientY;
      if (touchY > canvas.height * 0.7) {
        player.x = touchX;
      }
    });

    canvas.addEventListener("touchend", () => stopFiring());

    function countdown() {
      gameTime--;
      document.getElementById("timer").innerText = gameTime;
      if (gameTime <= 0) {
        clearInterval(timerId);
        alert("Time's up! Final Score: " + score);
      }
    }

    timerId = setInterval(countdown, 1000);
    setInterval(spawnObstacle, 500);
    updateGame();
  </script>
</body>
</html>