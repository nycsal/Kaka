<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>KaKaReza Shooting Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
    }

    canvas {
      display: block;
    }

    #scoreboard {
      color: white;
      font-family: Arial, sans-serif;
      font-size: 20px;
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      background-color: rgba(0,0,0,0.6);
      padding: 10px 20px;
      border-radius: 10px;
    }

    #scoreboard h1 {
      margin: 0;
      font-size: 18px;
      color: #ffcc00;
    }

    #scoreboard p {
      margin: 5px 0 0;
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    <h1>KaKaReza Shooting Game</h1>
    <p>Score: <span id="score">0</span></p>
  </div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    const player = {
      x: width / 2,
      y: height - 80,
      width: 50,
      height: 30,
      color: "lime",
      speed: 10
    };

    let bullets = [];
    let obstacles = [];
    let score = 0;
    let fireRate = 200;
    let canFire = true;
    let hitCount = 0;

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x - player.width/2, player.y - player.height/2, player.width, player.height);
      // Draw nozzle
      ctx.fillStyle = "red";
      ctx.fillRect(player.x - 5, player.y - player.height / 2 - 10, 10, 10);
    }

    function drawBullet(bullet) {
      ctx.fillStyle = bullet.color;
      ctx.fillRect(bullet.x - 2, bullet.y, 4, 10);
    }

    function drawObstacle(obstacle) {
      ctx.fillStyle = obstacle.color;
      ctx.fillRect(obstacle.x, obstacle.y, obstacle.size, obstacle.size);
    }

    function drawExplosion(x, y) {
      ctx.fillStyle = "orange";
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, Math.PI * 2);
      ctx.fill();
    }

    function updateBullets() {
      bullets.forEach(bullet => bullet.y -= bullet.speed);
      bullets = bullets.filter(b => b.y > 0);
    }

    function updateObstacles() {
      obstacles.forEach(o => o.y += o.speed);
      obstacles = obstacles.filter(o => o.y < height);
    }

    function detectCollisions() {
      for (let i = bullets.length - 1; i >= 0; i--) {
        for (let j = obstacles.length - 1; j >= 0; j--) {
          const b = bullets[i];
          const o = obstacles[j];
          if (
            b.x > o.x && b.x < o.x + o.size &&
            b.y > o.y && b.y < o.y + o.size
          ) {
            drawExplosion(o.x + o.size/2, o.y + o.size/2);
            bullets.splice(i, 1);
            obstacles.splice(j, 1);
            score++;
            hitCount++;
            document.getElementById("score").innerText = score;
            return;
          }
        }
      }
    }

    function spawnObstacle() {
      const size = 30;
      const x = Math.random() * (width - size);
      const speed = 2 + Math.random() * 2;
      const colors = ["red", "blue", "green", "yellow", "purple"];
      obstacles.push({
        x, y: -size, size, speed, color: colors[Math.floor(Math.random()*colors.length)]
      });
    }

    function fireBullet() {
      if (canFire) {
        bullets.push({ x: player.x, y: player.y - 30, speed: 8, color: "white" });
        if (hitCount >= 5) {
          bullets.push({ x: player.x - 10, y: player.y - 30, speed: 8, color: "white" });
        }
        if (hitCount >= 10) {
          bullets.push({ x: player.x + 10, y: player.y - 30, speed: 8, color: "white" });
        }
        canFire = false;
        setTimeout(() => { canFire = true; }, fireRate);
      }
    }

    function gameLoop() {
      ctx.clearRect(0, 0, width, height);
      drawPlayer();
      updateBullets();
      updateObstacles();
      detectCollisions();

      bullets.forEach(drawBullet);
      obstacles.forEach(drawObstacle);

      requestAnimationFrame(gameLoop);
    }

    setInterval(spawnObstacle, 500);
    setInterval(fireBullet, 150);

    let isMoving = false;
    let touchStartX = 0;

    canvas.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      if (touch.clientY > height - 150) {
        isMoving = true;
        touchStartX = touch.clientX;
      }
    });

    canvas.addEventListener("touchmove", e => {
      if (!isMoving) return;
      const touch = e.touches[0];
      const dx = touch.clientX - touchStartX;
      player.x += dx;
      if (player.x < player.width/2) player.x = player.width/2;
      if (player.x > width - player.width/2) player.x = width - player.width/2;
      touchStartX = touch.clientX;
    });

    canvas.addEventListener("touchend", e => {
      isMoving = false;
    });

    // Shooting anywhere else
    canvas.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      if (touch.clientY < height - 150) {
        fireBullet();
      }
    });

    window.addEventListener("resize", () => {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    });

    gameLoop();
  </script>
</body>
</html>
